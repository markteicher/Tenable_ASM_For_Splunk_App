<dashboard version="1.1">
  <label>Tenable ASM â€“ Suggestions</label>
  <description>
    Visibility into Tenable Attack Surface Management suggestions, types, and rule complexity.
  </description>

  <!-- ========================= -->
  <!-- Suggestion Counts -->
  <!-- ========================= -->
  <row>

    <panel>
      <title>Total Suggestions</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=tenable:asm:suggestions
            | stats dc(id) as total
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>

    <panel>
      <title>Active Suggestions</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=tenable:asm:suggestions
            | where isnull(deleted_at) OR deleted_at=""
            | stats dc(id) as active
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>

    <panel>
      <title>Archived Suggestions</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=tenable:asm:suggestions
            | where isnotnull(deleted_at) AND deleted_at!=""
            | stats dc(id) as archived
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>

  </row>

  <!-- ========================= -->
  <!-- Suggestion Type Distribution -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Suggestions by Type</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=tenable:asm:suggestions
            | stats count by suggestion_type
            | sort - count
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">Suggestion Type</option>
        <option name="charting.axisTitleY.text">Count</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Rules per Suggestion -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Rules per Suggestion</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=tenable:asm:suggestions
            | eval rule_count = mvcount('suggestion_details.rules{}.rule')
            | stats avg(rule_count) as avg_rules
                    max(rule_count) as max_rules
                    min(rule_count) as min_rules
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.axisTitleX.text">Metric</option>
        <option name="charting.axisTitleY.text">Rule Count</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

</dashboard>
