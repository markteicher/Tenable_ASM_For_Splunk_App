<dashboard version="1.1">
  <label>Tenable ASM â€“ Assets</label>
  <description>
    Complete asset inventory with full metadata, enrichment, technology fingerprinting,
    and update visibility from Tenable Attack Surface Management.
  </description>

  <!-- ========================= -->
  <!-- Asset Summary -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Total Assets</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets
            | stats count
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>

    <panel>
      <title>Assets by Severity</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets
            | stats count by bd.severity_ranking
            | sort -count
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>

    <panel>
      <title>Hidden Assets</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets hidden=true
            | stats count
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- App Update Timestamps -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>App Update Timestamps</title>
      <table>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets
            | eval
                domaininfo  = 'app_updates.domaininfo',
                ipgeo       = 'app_updates.ipgeo',
                own_body    = 'app_updates.own_body',
                own_header  = 'app_updates.own_header',
                ports       = 'app_updates.ports',
                rbls        = 'app_updates.rbls',
                screenshot  = 'app_updates.screenshot',
                ssl         = 'app_updates.ssl',
                wtech       = 'app_updates.wtech'
            | stats
                latest(domaininfo)  as domaininfo
                latest(ipgeo)       as ipgeo
                latest(own_body)    as own_body
                latest(own_header)  as own_header
                latest(ports)       as ports
                latest(rbls)        as rbls
                latest(screenshot)  as screenshot
                latest(ssl)         as ssl
                latest(wtech)       as wtech
            | eval
                component_updates = mvappend(
                  "domaininfo: " . domaininfo,
                  "ipgeo: " . ipgeo,
                  "own_body: " . own_body,
                  "own_header: " . own_header,
                  "ports: " . ports,
                  "rbls: " . rbls,
                  "screenshot: " . screenshot,
                  "ssl: " . ssl,
                  "wtech: " . wtech
                )
            | mvexpand component_updates
            | rex field=component_updates "(?<component>[^:]+): (?<last_update>.*)"
            | table component last_update
            | sort component
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Technology & Exposure -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Top Technologies Detected</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets
            | mvexpand wtech.*
            | stats count by wtech.*
            | sort -count
            | head 15
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>

    <panel>
      <title>Assets with Open Ports</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets
            | where isnotnull('ports.ports')
            | stats count
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- FULL Asset Dataset -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Asset Details (All Fields)</title>
      <table>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:assets
            | sort -bd.last_metadata_change
          </query>
        </search>

        <option name="count">25</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

</dashboard>
