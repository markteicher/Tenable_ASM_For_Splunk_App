<dashboard version="1.1">
  <label>Tenable ASM â€“ User Activity</label>
  <description>
    User, automation, and system activity within Tenable Attack Surface Management.
  </description>

  <!-- ========================= -->
  <!-- Filters -->
  <!-- ========================= -->
  <form>

    <input type="multiselect" token="actor_tok">
      <label>Actor</label>
      <choice value="*">All</choice>
      <search>
        <query>
          index=$ASM_INDEX$ sourcetype=asm:user_activity
          | stats count by actor
          | sort actor
          | table actor
        </query>
      </search>
      <fieldForLabel>actor</fieldForLabel>
      <fieldForValue>actor</fieldForValue>
      <delimiter>,</delimiter>
    </input>

    <input type="multiselect" token="email_tok">
      <label>Email</label>
      <choice value="*">All</choice>
      <search>
        <query>
          index=$ASM_INDEX$ sourcetype=asm:user_activity
          | stats count by email
          | sort email
          | table email
        </query>
      </search>
      <fieldForLabel>email</fieldForLabel>
      <fieldForValue>email</fieldForValue>
      <delimiter>,</delimiter>
    </input>

  </form>

  <!-- ========================= -->
  <!-- KPI -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Total Activity Events</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search actor IN ($actor_tok$) email IN ($email_tok$)
            | stats count
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Time-Based Trends -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Week over Week Activity</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search actor IN ($actor_tok$) email IN ($email_tok$)
            | timechart span=1w count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Month over Month Activity</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search actor IN ($actor_tok$) email IN ($email_tok$)
            | timechart span=1mon count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Quarter over Quarter Activity</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search actor IN ($actor_tok$) email IN ($email_tok$)
            | timechart span=1q count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Year over Year Activity</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search actor IN ($actor_tok$) email IN ($email_tok$)
            | timechart span=1y count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Activity Details + Drilldown -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>User Activity Details</title>
      <table>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search actor IN ($actor_tok$) email IN ($email_tok$)
            | table _time actor actor_id email action target inventory_id description
            | sort -_time
          </query>
        </search>

        <option name="count">25</option>
        <option name="wrap">true</option>
        <option name="drilldown">row</option>

        <drilldown>
          <link>
            <![CDATA[
            /app/$app$/asm_users
            ?form.actor=$row.actor$
            &form.email=$row.email$
            ]]>
          </link>
        </drilldown>

      </table>
    </panel>
  </row>

</dashboard>
