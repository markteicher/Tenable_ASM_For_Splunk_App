<dashboard version="1.1">
  <label>Tenable ASM â€“ User Activity</label>
  <description>
    User and system activity logs from Tenable Attack Surface Management, including actions, actors, and trends.
  </description>

  <!-- ========================= -->
  <!-- Filters -->
  <!-- ========================= -->
  <fieldset submitButton="false">

    <input type="multiselect" token="actor_tok">
      <label>Actor</label>
      <choice value="*">All</choice>
      <prefix>actor="</prefix>
      <suffix>"</suffix>
      <search>
        <query>
          index=$ASM_INDEX$ sourcetype=asm:user_activity
          | stats count by actor
          | sort actor
        </query>
      </search>
      <fieldForLabel>actor</fieldForLabel>
      <fieldForValue>actor</fieldForValue>
    </input>

    <input type="multiselect" token="email_tok">
      <label>Email</label>
      <choice value="*">All</choice>
      <prefix>email="</prefix>
      <suffix>"</suffix>
      <search>
        <query>
          index=$ASM_INDEX$ sourcetype=asm:user_activity
          | stats count by email
          | sort email
        </query>
      </search>
      <fieldForLabel>email</fieldForLabel>
      <fieldForValue>email</fieldForValue>
    </input>

  </fieldset>

  <!-- ========================= -->
  <!-- Summary Metrics -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Total Activity Records</title>
      <single>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | stats count
          </query>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Activity Trends -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Weekly Activity by Action</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | timechart span=1w count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Monthly Activity by Action</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | timechart span=1mon count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Quarterly Activity by Action</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | timechart span=1q count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Yearly Activity by Action</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | timechart span=1y count by action
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Top Actors / Actions -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Top Actors</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | stats count by actor
            | sort -count
            | head 10
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>

    <panel>
      <title>Top Actions</title>
      <chart>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | stats count by action
            | sort -count
            | head 10
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Activity Detail Table -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Activity Log Details</title>
      <table>
        <search>
          <query>
            index=$ASM_INDEX$ sourcetype=asm:user_activity
            | search $actor_tok$ $email_tok$
            | table _time actor actor_id email action target inventory_id description
            | sort -_time
          </query>
        </search>
        <option name="count">25</option>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

</dashboard>
